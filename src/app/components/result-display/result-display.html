<mat-card class="result-card">
  <mat-card-header>
    <mat-card-title>Chi tiết chia tiền</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <ng-container *ngIf="(expenses$ | async) as expenses">
      <ng-container *ngIf="(members$ | async) as members">
        <div class="table-container">
          <table mat-table [dataSource]="expenses" class="mat-elevation-z8">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Khoản mục</th>
              <td mat-cell *matCellDef="let expense">{{expense.name}}</td>
              <td mat-footer-cell *matFooterCellDef>
                <strong>Tổng cộng</strong>
              </td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Số tiền</th>
              <td mat-cell *matCellDef="let expense">
                {{formatAmount(expense.amount)}}
              </td>
              <td mat-footer-cell *matFooterCellDef>
                <strong>{{formatAmount(getTotalAmount(expenses))}}</strong>
              </td>
            </ng-container>

            <!-- Participants Column -->
            <ng-container matColumnDef="participants">
              <th mat-header-cell *matHeaderCellDef>Người tham gia</th>
              <td mat-cell *matCellDef="let expense">
                {{getParticipants(expense, members)}}
                ({{getParticipantCount(expense, members)}} người)
              </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <!-- Per Person Column -->
            <ng-container matColumnDef="perPerson">
              <th mat-header-cell *matHeaderCellDef>Mỗi người trả</th>
              <td mat-cell *matCellDef="let expense">
                {{formatAmount(calculatePerPerson(expense.amount,
                getParticipantCount(expense, members)))}}
              </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumns; sticky: true"
            ></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            <tr
              mat-footer-row
              *matFooterRowDef="displayedColumns; sticky: true"
            ></tr>
          </table>
        </div>

        <div class="member-summary" *ngIf="members.length > 0">
          <h3>Tổng tiền mỗi người cần trả:</h3>
          <div class="member-amounts">
            <div *ngFor="let member of members" class="member-amount">
              <span class="member-name">{{member.name}}</span>
              <span class="amount">{{formatAmount(member.totalAmount)}}</span>
            </div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </mat-card-content>
</mat-card>
